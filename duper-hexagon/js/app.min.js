var duperHexagon=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=[{name:"pixel_world",location:["assets/music/pixel_world_lo.ogg","assets/music/pixel_world_lo.mp3"]},{name:"second_source",location:["assets/music/second_source_lo.ogg","assets/music/second_source_lo.mp3"]},{name:"reboot_complete",location:["assets/music/reboot_complete_lo.ogg","assets/music/reboot_complete_lo.mp3"]}],p=[{rotation_speed:.01,player_speed:Math.PI/40,player_color:16738047,center_color:16724991,obstacle_color:16738047,bgcolor1:6697830,bgcolor2:4465220,obstacle_speed:4,first_tick:0,obstacle_types:["single45","single5op","4labyrinth","4ifuckedup"],song:"pixel_world"},{rotation_speed:.015,player_speed:3*Math.PI/80,player_color:3394781,center_color:61183,obstacle_color:3394781,bgcolor1:2254438,bgcolor2:1328196,obstacle_speed:6,first_tick:30,obstacle_types:["single5","ifuckedup","quickrepeat","quickalt","multi4"],song:"second_source"},{rotation_speed:.02,player_speed:Math.PI/20,player_color:16737843,center_color:16742208,obstacle_color:16737843,bgcolor1:6692880,bgcolor2:4461580,obstacle_speed:8,first_tick:60,obstacle_types:["fat5","fat5op","ifuckedup","labyrinth","quickeralt","multi4","4fast"],song:"reboot_complete"},{rotation_speed:.01,player_speed:Math.PI/40,player_color:10044569,center_color:10040217,obstacle_color:10044569,obstacle_color_light:13395660,obstacle_color_dark:7541107,bgcolor1:3349555,bgcolor2:2232610,obstacle_speed:4,first_tick:0,obstacle_types:["4through","5rebound","4ifuckeduprebound","4labyrinthrebound","quickaltrebound","quickaltthrough"],song:"pixel_world"},{rotation_speed:.015,player_speed:3*Math.PI/80,player_color:3381674,center_color:43707,obstacle_color:3381674,bgcolor1:2053461,bgcolor2:1061683,obstacle_color_light:5627391,obstacle_color_dark:2123383,obstacle_speed:6,first_tick:30,obstacle_types:["4through","5rebound","ifuckeduprebound","quickrepeatrebound","multi4rebound","quickaltthrough"],song:"second_source"},{rotation_speed:.02,player_speed:Math.PI/20,player_color:13391138,center_color:13395504,obstacle_color:13391138,bgcolor1:5248780,bgcolor2:3346441,obstacle_color_light:16746581,obstacle_color_dark:10043420,obstacle_speed:8,first_tick:60,obstacle_types:["fat5oprebound","ifuckedupthrough","labyrinththrough","quickaltthrough","multi4through","4fastthrough"],song:"reboot_complete"},{rotation_speed:.01,player_speed:Math.PI/40,player_color:16751103,center_color:16738047,obstacle_color:16751103,bgcolor1:10046617,bgcolor2:6697830,obstacle_speed:4,first_tick:0,obstacle_types:["single45","single5op","4labyrinth","4ifuckedup"],song:"pixel_world",overtime:!0},{rotation_speed:.015,player_speed:3*Math.PI/80,player_color:6741486,center_color:3403519,obstacle_color:6741486,bgcolor1:3381657,bgcolor2:1992294,obstacle_speed:6,first_tick:30,obstacle_types:["single5","ifuckedup","quickrepeat","quickalt","multi4"],song:"second_source",overtime:!0},{rotation_speed:.02,player_speed:Math.PI/20,player_color:16746564,center_color:16742195,obstacle_color:16746564,bgcolor1:10039320,bgcolor2:6692370,obstacle_speed:8,first_tick:60,obstacle_types:["fat5","fat5op","ifuckedup","labyrinth","quickeralt","multi4","4fast"],song:"reboot_complete",overtime:!0}],q=800,r=600,s=10,t=40,u=20,v=6,w=52,x=1.0116,y=Math.sqrt(3),z=5*Math.PI/6,A=[0,0,0,0,0,0],B=!1,C=!1,D=function(){b=[0];for(var a=2*Math.PI/v,c=1;v>=c;c++)b.push(c*a);var d=$(0,t+u,3,s,Math.PI/2);h.beginFill(l.player_color),h.drawPolygon(d),h.endFill(),g.add(h)},E=[],F=[],G=function(){var a=function(a,b){var c=b===!0?K:I,d=b===!0?L:J,e=b===!0?F:E,f=b===!0?Q:O,g=b===!0?R:P;if(0!==e[a].x){var h=Math.abs(e[a].y/e[a].x);c[a]=1/Math.sqrt(1+h*h),d[a]=h*c[a]}else c[a]=0,d[a]=1;c[a]=e[a].x<0?-c[a]:c[a],d[a]=e[a].y<0?-d[a]:d[a];var i=t+u+2*s,j=t+u;b===!0&&(i+=w/2,j-=w/2),f[a]={x:i*c[a],y:i*d[a]},g[a]={x:j*c[a],y:j*d[a]}},b=Math.sqrt(q*q+r*r)/2,c=2*b/y;0===E.length&&(E.push(new Phaser.Point(0,c)),E.push(new Phaser.Point(-b,c/2)),E.push(new Phaser.Point(-b,-c/2)),E.push(new Phaser.Point(0,-c)),E.push(new Phaser.Point(b,-c/2)),E.push(new Phaser.Point(b,c/2)),E.push(E[0]),F.push(new Phaser.Point(-b/2,3*c/4)),F.push(new Phaser.Point(-b,0)),F.push(new Phaser.Point(-b/2,-3*c/4)),F.push(new Phaser.Point(b/2,-3*c/4)),F.push(new Phaser.Point(b,0)),F.push(new Phaser.Point(b/2,3*c/4)),F.push(F[0]));for(var d=0;6>d;d++)a(d,!0),a(d,!1);I[6]=I[0],J[6]=J[0],K[6]=K[0],L[6]=L[0]},H=function(){for(var a=[],b=new Phaser.Point(0,0),c=0;6>c;c++)a.push(new Phaser.Polygon([E[c],E[c+1],b]));return a},I=[],J=[],K=[],L=[],M=[],N=[],O=[],P=[],Q=[],R=[],S=function(a){return a.passes_through?l.obstacle_color_light:a.rebounds?l.obstacle_color_dark:l.obstacle_color},T=function(a){var b=a.interval,d=a.width,e=a.speed_multiplier,g=a.passes_through||!1,h=a.rebounds||!1,i=g||h?f:c,j=S(a),k=a.tick,m=0;k-na>0&&(m=(k-na)*l.obstacle_speed);var n=new Phaser.Point((E[b].x+m*I[b])*e,(E[b].y+m*J[b])*e),o=new Phaser.Point((E[b+1].x+m*I[b+1])*e,(E[b+1].y+m*J[b+1])*e),p=new Phaser.Point(o.x+d*I[b+1],o.y+d*J[b+1]),q=new Phaser.Point(n.x+d*I[b],n.y+d*J[b]),r=[n,o,p,q],s=new Phaser.Polygon(r),t=new Phaser.Graphics(Da,0,0);t.beginFill(j),t.drawPolygon(s),t.endFill(),i.add(t),M.push({width:d,shape:s,graphics:t,interval:b,speed:l.obstacle_speed,points:r,entered_danger:!1,left_danger:!1,speed_multiplier:e,passes_through:g,passing_through:!1,rebounds:h})},U=function(a){if(l.overtime){var b=a.interval,d=0;a.tick-na>0&&(d=(a.tick-na)*l.obstacle_speed);var e=Da.add.sprite(F[b].x+d*K[b],F[b].y+d*L[b],"pickup");e.anchor.x=.5,e.anchor.y=.5,c.add(e),e.interval=b,e.rotation=-5*Math.PI/6+Math.PI*b/3,N.push(e)}},V=function(){var b,c,d=function(a,c,d){c=c!==!1,d=d===!0;var e=c?b[0]:b[3],f=c===d?P:O,g=0!==f[a].x,h=0!==f[a].y;return d?(g=g&&e.x/f[a].x>1,h=h&&e.y/f[a].y>1):(g=g&&e.x/f[a].x<1,h=h&&e.y/f[a].y<1),g||h},e=[];M.map(function(f,g){b=f.points;var h=f.graphics;c=f.interval;var i=b[0].x,j=b[0].y,k=b[2].x,m=b[2].y,n=l.obstacle_speed*f.speed_multiplier,o=f.rebounds&&f.past_center?-1:1;if(b[0].x-=n*o*oa*I[c],b[0].y-=n*o*oa*J[c],b[1].x-=n*o*oa*I[c+1],b[1].y-=n*o*oa*J[c+1],b[2].x-=n*o*oa*I[c+1],b[2].y-=n*o*oa*J[c+1],b[3].x-=n*o*oa*I[c],b[3].y-=n*o*oa*J[c],f.rebounds&&f.past_center&&!f.rebounded){var p=f.width*I[f.interval],q=f.width*J[f.interval];Math.abs(b[0].x-b[3].x)<Math.abs(p)||Math.abs(b[0].y-b[3].y)<Math.abs(q)?b[3].x=b[2].x=b[3].y=b[2].y=0:(f.rebounded=!0,b[3].x=b[0].x-p,b[3].y=b[0].y-q,p=f.width*I[f.interval+1],q=f.width*J[f.interval+1],b[2].x=b[1].x-p,b[2].y=b[1].y-q)}i*b[0].x<=0&&j*b[0].y<=0&&!f.past_center&&(f.passes_through===!0?f.passing_through=!0:f.rebounded||(b[0].x=b[0].y=b[1].x=b[1].y=0));var r=k*b[2].x<=0&&m*b[2].y<=0;if(r&&(f.passes_through!==!0&&f.rebounds!==!0?(e.push(g),h.kill()):f.past_center||(f.past_center=!0)),!r||f.rebounds){if(f.passing_through||f.rebounded){var s=f.rebounds?c:(c+3)%6;b[0].x/E[s].x>1||b[0].y/E[s].y>1?(e.push(g),h.kill()):(!f.reentered_danger&&d(s,!0,!0)&&(f.reentered_danger=!0,A[s]++,a===s&&ba()),!f.releft_danger&&d(s,!1,!0)&&(f.releft_danger=!0,A[s]--))}f.past_center!==!0&&(f.entered_danger===!1&&d(c,!0,!1)&&(f.entered_danger=!0,A[c]++,a===c&&ba()),f.entered_danger===!0&&f.left_danger===!1&&d(c,!1,!1)&&(f.left_danger=!0,A[c]--)),f.shape.setTo(b),h.clear(),h.beginFill(S(f)),h.drawPolygon(f.shape),h.endFill()}});for(var f=e.length-1;f>=0;f--)M.splice(e[f],1);for(e=[],N.map(function(b,d){c=b.interval;var f=b.x,g=b.y;b.x-=l.pickup_speed*oa*K[c],b.y-=l.pickup_speed*oa*L[c],f*b.x<=0&&g*b.y<=0?(e.push(d),b.kill()):(b.x/Q[c].x<1||b.y/Q[c].y<1)&&(R[c].x/b.x<1||R[c].y/b.y<1)&&c===a&&(X(c),b.kill(),e.push(d))}),f=e.length-1;f>=0;f--)N.splice(f,1)},W={},X=function(){if(l.overtime){var a=Math.ceil((na-qa)/35);W[a]||(W[a]=Math.pow(x,a)),oa/=W[a],qa=na}},Y=function(){h.rotation=z},Z=function(a,b,c,d,e){var f=[],g=[];e=void 0===e?0:e;var h=y*d/2;if(6===c&&0===e)f=[a,a+h,a+h,a,a-h,a-h],g=[b+d,b+d/2,b-d/2,b-d,b-d/2,b+d/2];else for(var i=2*Math.PI/c,j=0;c>j;j++){var k=i*j+e;f.push(a+Math.cos(k)*d),g.push(b+Math.sin(k)*d)}return{x:f,y:g}},$=function(a,b,c,d,e){for(var f=Z(a,b,c,d,e),g=[],h=0;c>h;h++)g.push(new Phaser.Point(f.x[h],f.y[h]));return new Phaser.Polygon(g)},_=function(){for(var c=!1,d=1;d<b.length&&!c;d++)z<b[d]&&(a=d-1,c=!0);c||(a=b.length-1)},aa=function(b){var c=z;z+=b,0>z?z+=2*Math.PI:z>2*Math.PI&&(z-=2*Math.PI),_(),A[a]>0&&(z=c,_())},ba=function(){C=!0,B=!1,da=!1,ha=!1,Ba&&j.fadeOut(200),Ga.map(function(a){a()})},ca=!1,da=!1,ea=function(){h&&(h.clear(),N.map(function(a){a.kill()}),M.map(function(a){a.graphics.clear()}),N=[],M=[],A=[0,0,0,0,0,0]),fa.map(function(a){a.kill()}),ga.map(function(a){a.kill()}),C=!1,B=!0,na=0,oa=1,pa=l.first_tick*l.obstacle_speed,qa=0,ra=[],ta=0,ua=0,n=l.obstacle_types},fa=[],ga=[],ha=!1,ia=function(a){if(!ha){if(xa===!1)return window.setTimeout(function(){ia(a)},100),-1;l=p[a]?p[a]:p[k],l.pickup_speed=y*l.obstacle_speed/2,k=void 0!==a?a:k,wa=!1,da=!1,ea();var b=H(),c=new Phaser.Graphics(Da,0,0),f=new Phaser.Graphics(Da,0,0);c.beginFill(l.bgcolor1),f.beginFill(l.bgcolor2);for(var g=0;g<b.length;g++){var i=g%2===0?f:c;i.drawPolygon(b[g]);var j=g%2===0?ga:fa;j.push(i)}c.endFill(),f.endFill(),e.add(f),e.add(c);var m=new Phaser.Graphics(Da,0,0),n=$(0,0,v,t);m.clear(),m.beginFill(l.center_color),m.drawPolygon(n),m.endFill(),d.add(m),h=new Phaser.Graphics(Da,0,0),D(),_(),Y(),ca=!0}},ja=function(){j=Da.add.audio(l.song),j.loop=!0,j.volume=1,j.play()},ka=function(a){clearTimeout(m);var b=!Da.cache.checkSoundKey(l.song)||!Da.cache.isSoundDecoded(l.song);return xa===!1||Ba&&b?void window.setTimeout(function(){m=ka(a)},100):void(-1!==ia(a)&&(ca=!1,da=!0,Ba&&(j&&j.isPlaying?j.onFadeComplete.addOnce(function(){ja()}):ja()),Ea.map(function(a){a()}),(!Ba||Da.cache.isSoundDecoded(l.song))&&Fa.map(function(a){a()}),ha=!0))},la=function(a){B!==!1||void 0===a&&void 0===k||ia(a)},ma=function(a){B!==!1&&ca!==!0||void 0===a&&void 0===k||ka(a)},na=0,oa=1,pa=0,qa=0,ra=[],sa=6,ta=0,ua=0,va=function(){var a=[],b=function(b){for(var c=Math.round(b.start_tick),d=0;6>d;d++)-1===b.gaps.indexOf(d)&&a.push({tick:c,width:b.width,interval:d,speed_multiplier:b.speed_multiplier||1,passes_through:b.passes_through||!1,rebounds:b.rebounds||!1});c>ta&&b.pickups!==!1&&(ta=c,ua++,ua%sa===0&&ra.push({interval:b.gaps[Math.floor(Math.random()*b.gaps.length)],tick:Math.round(c)}))},c=l.obstacle_speed;if(pa-=c*oa,0>=pa){var d,e,f,g,h,i,j,k,m,o=n[Math.floor(Math.random()*n.length)];if("single45"===o){var p=240;for(f=0;4>f;f++){var q=Math.floor(6*Math.random()),r=Math.floor(6*Math.random());q===r&&"quick4s"===o&&r++,b({width:40,start_tick:na+f*p/c,gaps:[q,r]})}pa=960}else if("single5op"===o||"single5"===o||"fat5"===o||"fat5op"===o||"5rebound"===o||"fat5rebound"===o||"fat5oprebound"===o){for(d=Math.floor(6*Math.random()),e=(d+3)%6,h="5rebound"===o?2:1,f=0;4>f;f++)("single5"===o||"fat5"===o||"fat5rebound"===o)&&(d=Math.floor(6*Math.random()),e=d),g=40,("fat5"===o||"fat5op"===o||"fat5rebound"===o||"fat5oprebound"===o)&&(g=80),i="5rebound"===o||3===f&&("fat5rebound"===o||"fat5oprebound"===o),b({width:g,start_tick:na+h*f*240/c,gaps:f%2===0?[d]:[e],rebounds:i});pa=960*h,("fat5rebound"===o||"fat5oprebound"===o)&&(pa+=240)}else if("labyrinth"===o||"ifuckedup"===o||"4labyrinth"===o||"4ifuckedup"===o||"4ifuckeduprebound"===o||"ifuckeduprebound"===o||"4labyrinthrebound"===o||"labyrinthrebound"===o){i="ifuckeduprebound"===o||"4ifuckeduprebound"===o||"labyrinthrebound"===o||"4labyrinthrebound"===o;var s="ifuckedup"===o||"4ifuckedup"===o||"ifuckeduprebound"===o||"4ifuckeduprebound"===o;for(d=Math.floor(6*Math.random()),g=80,s&&(g=40),f=0;6>f;f++)j=(d+(Math.random()>.5?1:-1)+6)%6,k=[d],m=[d,j],("4labyrinth"===o||"4ifuckedup"===o||"4labyrinthrebound"===o||"4ifuckeduprebound"===o)&&(k.push((d+3)%6),m.push((d+3)%6),m.push((j+3)%6)),b({width:g,start_tick:na+160*f/c,gaps:k,pickups:5===f,rebounds:i&&5===f}),5>f&&b({width:g,start_tick:na+(80+160*f)/c,gaps:m,pickups:!1}),d=j;pa=1120,i&&(pa+=s?40:80)}else if("labyrinththrough"===o||"ifuckedupthrough"===o){for(d=Math.floor(6*Math.random()),g="labyrinththrough"===o?80:40,f=0;6>f;f++)k=[d],j=(d+(Math.random()>.5?1:-1)+6)%6,m=[d,j],4===f?m=[d,(d+1)%6,(d+5)%6]:5===f&&(k=[(d+1)%6,(d+5)%6]),b({width:g,start_tick:na+160*f/c,gaps:k,passes_through:5===f,pickups:5===f}),5>f&&b({width:g,start_tick:na+(80+160*f)/c,gaps:m,pickups:!1}),4>=f&&(d=j);pa=1160,"labyrinththrough"===o&&(pa+=40)}else if("quickalt"===o||"quickeralt"===o||"quickaltrebound"===o||"quickaltthrough"===o){for(f=0;3>f;f++)b({width:40,start_tick:na+320*f/c,gaps:[0,2,4]}),b({width:40,start_tick:na+(160+320*f)/c,gaps:[1,3,5],rebounds:2===f&&"quickaltrebound"===o,passes_through:2===f&&"quickaltthrough"===o});pa=1080,"quickeralt"===o?pa-=120:("quickaltrebound"===o||"quickaltthrough"===o)&&(pa+=120)}else if("multi4"===o||"multi5"===o||"multi4rebound"===o||"multi4through"===o){for(f=0;3>f;f++){var t,u,v=Math.floor(6*Math.random());if("multi5"===o)t=[(v+1)%6,(v+3)%6,(v+5)%6],u=[v,(v+2)%6,(v+4)%6,(v+5)%6];else{var w=Math.random()<.5;t=[(v+1)%6,(v+2)%6,(v+4)%6,(v+5)%6],u=[v,(v+(w?1:2))%6,(v+3)%6,(v+(w?4:5))%6]}b({width:40,start_tick:na+320*f/c,gaps:t,rebounds:2===f&&"multi4rebound"===o,passes_through:2===f&&"multi4through"===o}),b({width:40,start_tick:na+320*f/c,gaps:u,speed_multiplier:1.5,rebounds:2===f&&"multi4rebound"===o,passes_through:2===f&&"multi4through"===o})}pa=960,("multi4rebound"===o||"multi4through"===o)&&(pa+=120)}else if("quickrepeat"===o||"quickrepeatrebound"===o){d=Math.floor(6*Math.random());for(var x=0,y=0;4>y;y++){var z=Math.floor(2*Math.random())+2;for(f=0;z>f;f++)b({width:72,start_tick:na+140*(f+x)/c,gaps:[d],rebounds:f===z-1&&3===y&&"quickrepeatrebound"===o,pickups:5===f}),(z-1>f||3>y)&&(e=(d+(y%2===0?1:5))%6,b({width:72,start_tick:na+(140*(f+x)+70)/c,gaps:[d,e],pickups:!1}),d=e);x+=z}pa=140*(x+1),"quickrepeatrebound"===o&&(pa+=180)}else if("4fast"===o||"4fastrebound"===o||"4fastthrough"===o){for(h="4fastrebound"===o||"4fastthrough"===o?1.5:1,f=0;6>f;f++)d=Math.floor(6*Math.random()),b({width:40,start_tick:na+h*f*240/c,gaps:[d,(d+3)%6],speed_multiplier:1.5,rebounds:"4fastrebound"===o,passes_through:"4fastthrough"===o});pa=1440*h}else if("4through"===o){for(f=0;3>f;f++)d=Math.floor(6*Math.random()),e=Math.random()>.25?(d+2)%6:(d+3)%6,b({width:40,start_tick:na+360*f/c,gaps:[d,e],passes_through:!0});pa=1080}}for(;a.length>0;)T(a.shift());for(;ra.length>0;)U(ra.shift())},wa=!1,xa=!1,ya=function(){C===!1&&B===!0&&(Da.world.rotation+=l.rotation_speed*oa)},za=function(){if(o.length>0){var a=o.shift(),b=new Phaser.Loader(Da),c=b.audio(a.name,a.location);b.start(),c.onLoadComplete.addOnce(za)}},Aa=!0,Ba=!0,Ca={preload:function(){Da.load.image("pickup","assets/img/pickup.png")},create:function(){Ba&&za(),xa=!0,Da.stage.disableVisibilityChange=!0,Da.world.setBounds(-q/2,-r/2,q/2,r/2),G(),e=Da.add.group(),c=Da.add.group(),d=Da.add.group(),f=Da.add.group(),g=Da.add.group(),i=Da.input.keyboard.createCursorKeys(),i.A=Da.input.keyboard.addKey(Phaser.Keyboard.A),i.D=Da.input.keyboard.addKey(Phaser.Keyboard.D),i.enter=Da.input.keyboard.addKey(Phaser.Keyboard.ENTER),i.enter.onDown.add(function(){Aa&&ma()})},update:function(){if(ya(),da){var a=i.left.isDown||i.A.isDown,b=i.right.isDown||i.D.isDown;a?(aa(-l.player_speed*oa),Y()):b&&(aa(l.player_speed*oa),Y())}wa&&!ca&&C===!1&&B===!0&&(va(),V(),l.overtime&&na%30===0&&(oa*=x),na++),wa||ca||!l||Ba&&!this.cache.isSoundDecoded(l.song)||(wa=!0,Fa.map(function(a){a()}))}},Da=new Phaser.Game(q,r,Phaser.AUTO,"game",Ca),Ea=[],Fa=[],Ga=[];return{start:ma,miniStart:la,end:ba,allowMoving:function(a){da=a},allowMusic:function(a){Ba=a,Ba&&za()},isGameCreated:function(){return xa},enterRestarts:function(a){Aa=a},addStartHandler:function(a){Ea.push(a)},addLoadHandler:function(a){Fa.push(a)},addCrashHandler:function(a){Ga.push(a)}}},app=angular.module("duper-hexagon",["LocalStorageModule"]);app.service("RecordSrv",["localStorageService",function(a){var b=null,c=function(){if(b)return b;b=[];for(var c=0;9>c;c++){var d=a.get("level"+c);d||(d=0),b.push(d)}return b},d=function(c,d){a.set("level"+c,d),b=null};return{getRecords:c,setRecord:d}}]),app.service("LevelUnlockSrv",["RecordSrv",function(a){var b=[[],[0],[1],[0],[1,3],[2,4],[3],[4,6],[5,7]],c=60,d=[!0,!1,!1,!1,!1,!1,!1,!1,!1],e=function(){for(var e=a.getRecords(),f=1;9>f;f++){for(var g=!0,h=0;h<b.length;h++)Number(e[b[f][h]])<c&&(g=!1);d[f]=g}return d},f=function(d){var e=a.getRecords(),f=[];if(e[d]>=c)return f;for(var g=1;g<b.length;g++)if(b[g].indexOf(d)>-1){var h=!0;b[g].map(function(a){d!==a&&e[a]<c&&(h=!1)}),h&&f.push(g)}return f};return{UNLOCK_AT:c,checkUnlock:e,levelUnlocks:f}}]),app.controller("MainCtrl",["$scope","$interval","$timeout","RecordSrv","LevelUnlockSrv",function(a,b,c,d,e){"use strict";var f,g=[{text:["Press Left and Right to move around the center hexagon.","Try not to crash."],duration:5e3},null,null,{text:["Lighter obstacles pass through the center to the other side.","Darker obstacles bounce off the center and travel back.","You'll need to dodge both of these twice."],duration:8e3},null,null,{text:["In Overtime mode, everything becomes faster and faster.","Pick up hexagons to reduce the speed."],duration:5e3},null,null],h=!1,i=!1;a.state={mode:"welcome",disable_music:!1,started:!1,crashed:!1,hints:[],time:0,selected_level:0,unlock_at:e.UNLOCK_AT,best_times:d.getRecords(),level_names:["Serenity","Tension","Panic","Serenity+","Tension+","Panic+","Serenity Overtime","Tension Overtime","Panic Overtime"],unlocked:e.checkUnlock(),loading:!1,next_unlock:[],start:function(a){n.unlocked[a]&&(n.show_welcome=!1,q.allowMusic(!n.disable_music),n.best_times[a]?o(a):(n.best_times[a]=0,g[a]?(n.mode="hints",n.hints=g[a].text,q.miniStart(a),q.allowMoving(!0),c(function(){o(a)},g[a].duration)):o(a)))},onKeyDown:function(a){q.isGameCreated()&&(13===a.which?k():27===a.which?l():a.which>=37&&a.which<=40&&m(a.which))},level_range:[0,1,2,3,4,5,6,7,8]};var j,k=function(){"welcome"===n.mode?n.unlocked[1]===!1?(n.mode="ingame",n.start(0)):n.mode="menu":"crashed"===n.mode?n.start(n.current_level):"menu"===n.mode&&n.start(n.selected_level)},l=function(){h=!0,n.mode="menu",n.started===!0&&(n.started=!1,q.end())},m=function(a){if("menu"===n.mode){var b=n.selected_level;37===a?(b--,(0>b||b%3===2)&&(b+=3)):38===a?(b-=3,0>b&&(b+=9)):39===a?(b++,b%3===0&&(b-=3)):40===a&&(b+=3,b>=9&&(b-=9)),n.unlocked[b]&&(n.selected_level=b)}},n=a.state,o=function(a){n.current_level=a,i=!0,n.crashed=!1,n.mode="ingame",c(function(){i===!0&&(n.mode="loading")},100),q.addLoadHandler(function(){i=!1,n.mode="ingame",n.started===!0&&p()}),q.start(a),c()},p=function(){n.time=0,f=Date.now(),j&&b.cancel(j),j=b(function(){n.time=((Date.now()-f)/1e3).toFixed(1)},100)},q=duperHexagon();q.addStartHandler(function(){n.started=!0,n.selected_level=n.current_level,n.mode="ingame",n.next_unlock=e.levelUnlocks(n.current_level),p()}),q.addCrashHandler(function(){if(b.cancel(j),n.crashed=!0,h)h=!1,n.mode="menu";else{if(n.time=Number(n.time),n.time>n.best_times[n.current_level]){d.setRecord(n.current_level,n.time),n.best_times[n.current_level]=n.time;var a=Math.floor(n.time);a>=n.unlock_at&&(n.unlocked=e.checkUnlock())}n.mode="crashed"}c()}),q.enterRestarts(!1),q.allowMusic(!1),q.miniStart(0)}]);